# Передача информации между цепочками/ботами

Почти в каждом боте нам требуется передавать данные от подписчика к менеджеру или администратору.

Рассмотрим передачу данных на примере чата с менеджером. Иными словами это ситуация когда подписчик бота запросил по кнопке переписку с менеджером. Нам требуется передавать сообщения от одного другому, а также передавать файлы и изображения.

Создадим 2 цепочки. Одна цепочка это цепочка бота с кнопкой подключения менеджера. Вторая цепочка это бот менеджера, где он пишет ответы подписчику по кнопке ответить.

<figure><img src="../.gitbook/assets/2697075b-12dd-4b40-aba8-12fd89d7e4f0.png" alt=""><figcaption></figcaption></figure>

Цепочка Подключение менеджера состоит из 3х блоков.

<figure><img src="../.gitbook/assets/b6bdeb9f-9e78-4ce8-8fca-ba5fcede8143.png" alt=""><figcaption></figcaption></figure>

<figure><img src="../.gitbook/assets/07341281-7ef9-465e-b60b-f7e523fd4a11.png" alt=""><figcaption></figcaption></figure>

В Блоке #1 подписчик может нажать кнопку Подключить и начать переписку с менеджером.&#x20;

Когда подписчик первый раз нажимает кнопку подключить, ему необходимо показывать вводное сообщение. В процессе переписки мы ставим ... (можно ожидайте, подождите, вам пишут и т.п.). Поскольку оба эти сообщения выводим в Блоке #2, мы должны запоминать состояние (первый раз зашел или продолжает переписку). Это состояние мы будем хранить в переменном mgr. Перед нажатием на кнопку Подключить нам необходимо обнулить переменную mgr. Подключим сценарий действий, где переменной mgr присваиваем "ничего".

<figure><img src="../.gitbook/assets/ff42e9ee-81c2-4f32-9e8e-4f8421e8e624.png" alt=""><figcaption></figcaption></figure>

Блок #2 с помощью сценария действий Подключение менеджера 1 мы выводим подходящее сообщение и ждем сообщение от подписчика.

<figure><img src="../.gitbook/assets/59f62897-7578-4a4d-bd05-73c9ea7bd99d.png" alt=""><figcaption></figcaption></figure>

<figure><img src="../.gitbook/assets/bab40271-c7c8-4ba9-9e2d-b0f2f59fafcd.png" alt=""><figcaption></figcaption></figure>

<figure><img src="../.gitbook/assets/ca439417-f526-47a3-9da7-d6b94aac2d1c.png" alt=""><figcaption></figcaption></figure>

В Блоке #3 мы подключаем действие, которое отправляет сообщение в бот менеджера и запускает Блок #2

<figure><img src="../.gitbook/assets/6dd490e9-1b4b-4c81-8561-467fca9e549e.png" alt=""><figcaption></figcaption></figure>

Посколько подписчик может отправить файл или изображение или сообщение, то мы сначала принимаем файл и изображение, а затем отправляем сообщение с кнопкой Ответить.

<figure><img src="../.gitbook/assets/e90a3a67-3c90-4d8b-90bd-aa31d724d0a0.png" alt=""><figcaption></figcaption></figure>

<figure><img src="../.gitbook/assets/893292ea-c71a-4881-babf-a6befcd19aa5.png" alt=""><figcaption></figcaption></figure>

В кнопке Ответить мы передаем данные \[ClientID] и \[BotID] для отправки подписчику ответа из бота менеджера

<figure><img src="../.gitbook/assets/bda4e81b-a70d-4594-82c7-b454e2b2f4e5.png" alt=""><figcaption></figcaption></figure>

{% hint style="info" %}
Имейте ввиду, что длина строки с данными ограничена (у разных мессенджеров разная длина). Если сообщение не передается, возможно строка с данными слишком длинная.
{% endhint %}



В цепочке "Ответ менеджера клиенту" всего два блока, первый выводит инфосообщение "Напишите сообщение для \[Data1] (ClientID)", второй блок отправляет файлы и сообщение подписчику.

<figure><img src="../.gitbook/assets/040984dc-c508-4a4e-ba44-fad3d21ce09b.png" alt=""><figcaption></figcaption></figure>

<figure><img src="../.gitbook/assets/fdaa8671-c6be-422c-9f1c-1729aa03a672.png" alt=""><figcaption></figcaption></figure>

<figure><img src="../.gitbook/assets/70e76cd0-4a10-4e51-8f43-44ce1f56c610.png" alt=""><figcaption></figcaption></figure>

<figure><img src="../.gitbook/assets/0c892f19-04e9-4f2e-a628-255ed37e983b.png" alt=""><figcaption></figcaption></figure>

На этом сценарий готов к использованию. Если вам осталось что-либо непонятно, то ниже прикрепляем файл сценария. Вы можете загрузить его в свой аккаунт, подключить каналы к цепочкам, протестировать и разобрать сценарий детально. Учтите, что импорт доступен в настройках аккаунта только у оплаченных аккаунтов. Успехов вам!

{% embed url="https://drive.google.com/file/d/110CCT_sx5wJn7gudVOSq2Fb88icPpm8L/view?usp=sharing" %}

