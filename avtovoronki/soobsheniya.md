# Сообщения

Чтобы создать новую авторассылку сообщений или сценарий, нажмите нужную кнопку на странице настроек цепочки.

<figure><img src="../.gitbook/assets/Цепочка-сообщений (4) (1).png" alt=""><figcaption></figcaption></figure>

Сообщение может быть без и со сценарием.

**Сообщение без сценария** просто отправляется подписчику в порядке очереди сообщений в цепочке. При этом каждое сообщение может состоять из частей. В случае сообщения без сценария эти части будут отправлены подписчику сразу, одна за другой. Каждой части сообщения можно дать название. Для этого достаточно кликнуть по нему.

![](<../.gitbook/assets/Сообщение (1).png>)

Также можно менять порядок частей простым перетаскиванием. К каждой части сообщения можно прикрепить кнопки, которые могут быть ссылками или производить определенные действия.

Также можно прикрепить файлы изображений, PDF-файл, файлы Excel и Word.

В сообщениях можно использовать подстановки.

Сообщению можно задать интервал отправки и промежуток времени отправки.

![](<../.gitbook/assets/Сообщение (2).png>)

#### Сообщение со сценарием

Создавать сценарии можно без визуального конструктора и с ним. Это вопрос личного выбора. Мы рекомендуем настраивать сценарий на доске, так как прямо из него можно добавлять и настраивать сценарии действий.

![](<../.gitbook/assets/Сообщение (3).png>)

<figure><img src="../.gitbook/assets/Доска (14).png" alt=""><figcaption></figcaption></figure>

В режиме сценария, части сообщения выступают в роли отдельных сообщений. Переходы между сообщениями задаются логикой выполнения сценария, которую придумываете вы.



Давайте рассмотрим все настройки сценария.

_Выход из сценария по слову_

В режиме сценария, клиент не может получать сообщения дальше по цепочке _пока сценарий не будет завершен_. В большинстве случаев выход из сценария задается в конкретном сообщении сценария, когда цель выполнения сценария достигнута, но также существует возможность выходить из сценария по заданному слову.

{% hint style="info" %}
Если используете такую возможность, не забудьте сообщить об этом подписчику
{% endhint %}

_Сообщение при выходе из сценария_

Здесь вы можете выбрать сообщение сценария, которое запустится при выходе из него.

_Вернуться на шаг назад по слову_

Подписчик, выполняя сценарий, сможет по слову вернуться на шаг назад, если он ошибся.

{% hint style="info" %}
Если используете такую возможность, не забудьте сообщить об этом подписчику
{% endhint %}

**Настройки сообщения сценария**

Каждое сообщение сценария имеет свои настройки. Давайте рассмотрим каждую настройку по отдельности.

_Ожидание платежа_

Выставляется для запуска сообщения после получения платежа. Эта часть может быть никак не связана с другими частями сценарного сообщения.

{% hint style="info" %}
ВАЖНО. Сообщение ожидания платежа должно быть в том же сценарном сообщении, в котором была выдана платежная ссылка (прим.: с помощью сценария действий)
{% endhint %}

_Задержка перед запуском сообщения_

Сообщения внутри сценария также можно задерживать. Если задержка в секундах, то можно отправлять несколько сообщений подряд, которые, например, можно изменять с помощью сценария действий. Это может быть какой-нибудь отсчет 1.. 2.. 3.. перед долгожданной информацией.



_Сценарий действий_

{% hint style="info" %}
В этом месте сценарий действий запускается ДО запуска сообщения. Учитывайте это при разработке сценария.&#x20;
{% endhint %}

Сценарий действий выполняет работу с данными, платежами, ссылками, CRM, Google Таблицами, обмен данными при помощи запросов API.

Сценарий состоит из действий. По завершении сценария действий вы можете вернуться в сценарий сообщения. Для этого сообщение сценария должно содержать шаблон \[External], которое заменит сообщение из сценария действий.

_Запрос данных перед отправкой сообщения_

Перед тем, как отправить сообщение подписчику, мы можем обратиться на свой сервер и запросить данные.

Вернуть необходимо JSON строку в виде объекта или массива объектов.

Объект:

```
{ id: 1, data: “mydata” }
```

Массив объектов:

```
[
  { id: 1, data: “mydata1” },

  { id: 2, data: “mydata2” },

  { id: 3, data: “mydata3” }

]
```

где id это число, data – строка данных

В дальнейшем, вы можете использовать эти данные в сценарии и выводить их при помощи шаблона \[Data1], \[Data2], \[Data3] и т.д.

_Проверка ответа_

Следующий блок это проверка ответа на текущее сообщение. Ответом является сообщение подписчика, либо если подписчик нажал кнопку типа Значение, ответом будет передаваемой значение при нажатии на кнопку.

Мы может проверить ответ на следующее:

* является ли ответ числом
* является ли ответ телефонным номером
* является ли ответ адресом электронной почты
* проверка по регулярному выражению

Если ответ не прошел проверку, то вы можете указать сообщение, которое следует запустить в этом случае.

После прохождения проверки, вы можете добавить условия, при выполнении которых осуществяется переход к следующему сообщению или выход из сценария.

Если никакие дополнительные условия не требуются, то вы сможете сразу перейти к определенному сообщению или завершить сценарий.

#### Условия

Объектами для проверки в условиях являются ответы полученные на сообщения в сценарии и данные.

Нумерация ответов идет по порядку и, если мы хотим использовать в условиях ответ на первое сообщение, то нужно указать шаблон \[Answer1], на второе \[Answer2] и т.д.

Нумерация данных зависит от вас. Данные могут приходить при запуске сценария по кнопке, либо из запросов от внешних серверов. Использовать данные можно при помощи шаблонов \[Data1], \[Data2] и т.д.

{% hint style="info" %}
Шаблон ответа имеет 2 аналога:

\[Ответ1], \[Ответ2] и т.д. \[A1], \[A2] и т.д. (латиница)



Шаблон данных имеет 2 аналога:

\[Данные1], \[Данные2] и т.д. \[D1], \[D2] и т.д.
{% endhint %}

В условиях можно составлять как математические, так и логические выражения, используя числа и текст.

{% hint style="info" %}
Если условиях используются объекты - строки, содержащие символы =<>/\*(), то их следует брать в кавычки '', чтобы при проверке сервис их не принял за операторы сравнения или математические действия.
{% endhint %}

#### Сделать

В блоке сделать выполняются действия после проверок ответа и условий

_Сценарий действий_

Сценарий действий в этом блоке будет запущен после получения ответа на сообщение от клиента и завершения всех проверок.

_Выход из сценария_

Если сценарий подошел к завершению и вы получили от подписчика все, что хотели, вы должны завершить сценарий.

После завершения сценария, все собранные данные будут отправленые на почту, по вебхуку на ваш сервер, или в указанного бота, где была выполнена привязка для вас или вашего менеджера (отправку в боты также можно делать с помощью сценария действий, где вы сами формируете данные к отправке).

Также вы можете добавить или удалить теги, чтобы запустить или остановить другие цепочки сообщений.

Если в текущей цепочке сообщений присутствуют другие сообщения, то они будут отправлены подписчику с заданными в цепочке интервалами времени.

{% hint style="info" %}
После создания сообщений в цепочке, не забудьте включить цепочку на странице автоворонок
{% endhint %}

{% hint style="info" %}
Используйте подстановки в сообщениях для изучения и расширения возможностей. Все шаблоны замен и функции смотрите [здесь](../start/shablony-i-funkcii.md).
{% endhint %}

